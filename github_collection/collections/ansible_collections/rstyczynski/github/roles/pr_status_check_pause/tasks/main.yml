# INPUT VARIABLES TABLE
# | name                                | type   | description                                 |
# |-------------------------------------|--------|---------------------------------------------|
# | pr_status_check_pause_pr_status_check_delay| int | Seconds to wait between retry attempts |
# | pr_status_check_pause_has_pending_checks| bool | Whether there are pending checks        |
# | pr_status_check_pause_attempt_number| int    | Current attempt number                     |
# | pr_status_check_pause_pr_status_check_retries| int | Number of retry attempts              |
#
# OUTPUT VARIABLES TABLE
# | name  | type | description                                    |
# |-------|------|------------------------------------------------|
---
- name: "PR Check: Validate arguments"
  ansible.builtin.validate_argument_spec:
    argument_spec: "{{ (lookup('file', role_path + '/meta/argument_specs.yml') | from_yaml).argument_specs.main.options }}"

- name: "PR Check: Check PR status"
  ansible.builtin.include_role:
    name: rstyczynski.github.pr_status_check

- name: "PR Check: Wait before next attempt"

  ansible.builtin.pause:
    seconds: "{{ pr_status_check_pause_pr_status_check_delay }}"
  when:
    - pr_status_check_pause_has_pending_checks is defined
    - pr_status_check_pause_has_pending_checks | bool
    - pr_status_check_pause_attempt_number < pr_status_check_pause_pr_status_check_retries
